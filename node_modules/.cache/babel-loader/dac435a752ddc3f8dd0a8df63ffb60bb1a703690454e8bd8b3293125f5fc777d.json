{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar tslib_1 = require(\"tslib\");\nvar PDFAcroTerminal_1 = tslib_1.__importDefault(require(\"./PDFAcroTerminal\"));\nvar PDFHexString_1 = tslib_1.__importDefault(require(\"../objects/PDFHexString\"));\nvar PDFString_1 = tslib_1.__importDefault(require(\"../objects/PDFString\"));\nvar PDFArray_1 = tslib_1.__importDefault(require(\"../objects/PDFArray\"));\nvar PDFName_1 = tslib_1.__importDefault(require(\"../objects/PDFName\"));\nvar flags_1 = require(\"./flags\");\nvar errors_1 = require(\"../errors\");\nvar PDFAcroChoice = /** @class */function (_super) {\n  tslib_1.__extends(PDFAcroChoice, _super);\n  function PDFAcroChoice() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n  PDFAcroChoice.prototype.setValues = function (values) {\n    if (this.hasFlag(flags_1.AcroChoiceFlags.Combo) && !this.hasFlag(flags_1.AcroChoiceFlags.Edit) && !this.valuesAreValid(values)) {\n      throw new errors_1.InvalidAcroFieldValueError();\n    }\n    if (values.length === 0) {\n      this.dict.delete(PDFName_1.default.of('V'));\n    }\n    if (values.length === 1) {\n      this.dict.set(PDFName_1.default.of('V'), values[0]);\n    }\n    if (values.length > 1) {\n      if (!this.hasFlag(flags_1.AcroChoiceFlags.MultiSelect)) {\n        throw new errors_1.MultiSelectValueError();\n      }\n      this.dict.set(PDFName_1.default.of('V'), this.dict.context.obj(values));\n    }\n    this.updateSelectedIndices(values);\n  };\n  PDFAcroChoice.prototype.valuesAreValid = function (values) {\n    var options = this.getOptions();\n    var _loop_1 = function (idx, len) {\n      var val = values[idx].decodeText();\n      if (!options.find(function (o) {\n        return val === (o.display || o.value).decodeText();\n      })) {\n        return {\n          value: false\n        };\n      }\n    };\n    for (var idx = 0, len = values.length; idx < len; idx++) {\n      var state_1 = _loop_1(idx, len);\n      if (typeof state_1 === \"object\") return state_1.value;\n    }\n    return true;\n  };\n  PDFAcroChoice.prototype.updateSelectedIndices = function (values) {\n    if (values.length > 1) {\n      var indices = new Array(values.length);\n      var options = this.getOptions();\n      var _loop_2 = function (idx, len) {\n        var val = values[idx].decodeText();\n        indices[idx] = options.findIndex(function (o) {\n          return val === (o.display || o.value).decodeText();\n        });\n      };\n      for (var idx = 0, len = values.length; idx < len; idx++) {\n        _loop_2(idx, len);\n      }\n      this.dict.set(PDFName_1.default.of('I'), this.dict.context.obj(indices.sort()));\n    } else {\n      this.dict.delete(PDFName_1.default.of('I'));\n    }\n  };\n  PDFAcroChoice.prototype.getValues = function () {\n    var v = this.V();\n    if (v instanceof PDFString_1.default || v instanceof PDFHexString_1.default) return [v];\n    if (v instanceof PDFArray_1.default) {\n      var values = [];\n      for (var idx = 0, len = v.size(); idx < len; idx++) {\n        var value = v.lookup(idx);\n        if (value instanceof PDFString_1.default || value instanceof PDFHexString_1.default) {\n          values.push(value);\n        }\n      }\n      return values;\n    }\n    return [];\n  };\n  PDFAcroChoice.prototype.Opt = function () {\n    return this.dict.lookupMaybe(PDFName_1.default.of('Opt'), PDFString_1.default, PDFHexString_1.default, PDFArray_1.default);\n  };\n  PDFAcroChoice.prototype.setOptions = function (options) {\n    var newOpt = new Array(options.length);\n    for (var idx = 0, len = options.length; idx < len; idx++) {\n      var _a = options[idx],\n        value = _a.value,\n        display = _a.display;\n      newOpt[idx] = this.dict.context.obj([value, display || value]);\n    }\n    this.dict.set(PDFName_1.default.of('Opt'), this.dict.context.obj(newOpt));\n  };\n  PDFAcroChoice.prototype.getOptions = function () {\n    var Opt = this.Opt();\n    // Not supposed to happen - Opt _should_ always be `PDFArray | undefined`\n    if (Opt instanceof PDFString_1.default || Opt instanceof PDFHexString_1.default) {\n      return [{\n        value: Opt,\n        display: Opt\n      }];\n    }\n    if (Opt instanceof PDFArray_1.default) {\n      var res = [];\n      for (var idx = 0, len = Opt.size(); idx < len; idx++) {\n        var item = Opt.lookup(idx);\n        // If `item` is a string, use that as both the export and text value\n        if (item instanceof PDFString_1.default || item instanceof PDFHexString_1.default) {\n          res.push({\n            value: item,\n            display: item\n          });\n        }\n        // If `item` is an array of one, treat it the same as just a string,\n        // if it's an array of two then `item[0]` is the export value and\n        // `item[1]` is the text value\n        if (item instanceof PDFArray_1.default) {\n          if (item.size() > 0) {\n            var first = item.lookup(0, PDFString_1.default, PDFHexString_1.default);\n            var second = item.lookupMaybe(1, PDFString_1.default, PDFHexString_1.default);\n            res.push({\n              value: first,\n              display: second || first\n            });\n          }\n        }\n      }\n      return res;\n    }\n    return [];\n  };\n  return PDFAcroChoice;\n}(PDFAcroTerminal_1.default);\nexports.default = PDFAcroChoice;","map":{"version":3,"names":["PDFAcroTerminal_1","tslib_1","__importDefault","require","PDFHexString_1","PDFString_1","PDFArray_1","PDFName_1","flags_1","errors_1","PDFAcroChoice","_super","__extends","prototype","setValues","values","hasFlag","AcroChoiceFlags","Combo","Edit","valuesAreValid","InvalidAcroFieldValueError","length","dict","delete","default","of","set","MultiSelect","MultiSelectValueError","context","obj","updateSelectedIndices","options","getOptions","idx","len","val","decodeText","find","o","display","value","indices","Array","findIndex","sort","getValues","v","V","size","lookup","push","Opt","lookupMaybe","setOptions","newOpt","_a","res","item","first","second","exports"],"sources":["/Users/casarulez/Projects/Liquid-neurons/database_forms/data_entry_forms/node_modules/pdf-lib/src/core/acroform/PDFAcroChoice.ts"],"sourcesContent":["import PDFAcroTerminal from 'src/core/acroform/PDFAcroTerminal';\nimport PDFHexString from 'src/core/objects/PDFHexString';\nimport PDFString from 'src/core/objects/PDFString';\nimport PDFArray from 'src/core/objects/PDFArray';\nimport PDFName from 'src/core/objects/PDFName';\nimport { AcroChoiceFlags } from 'src/core/acroform/flags';\nimport {\n  InvalidAcroFieldValueError,\n  MultiSelectValueError,\n} from 'src/core/errors';\n\nclass PDFAcroChoice extends PDFAcroTerminal {\n  setValues(values: (PDFString | PDFHexString)[]) {\n    if (\n      this.hasFlag(AcroChoiceFlags.Combo) &&\n      !this.hasFlag(AcroChoiceFlags.Edit) &&\n      !this.valuesAreValid(values)\n    ) {\n      throw new InvalidAcroFieldValueError();\n    }\n\n    if (values.length === 0) {\n      this.dict.delete(PDFName.of('V'));\n    }\n    if (values.length === 1) {\n      this.dict.set(PDFName.of('V'), values[0]);\n    }\n    if (values.length > 1) {\n      if (!this.hasFlag(AcroChoiceFlags.MultiSelect)) {\n        throw new MultiSelectValueError();\n      }\n      this.dict.set(PDFName.of('V'), this.dict.context.obj(values));\n    }\n\n    this.updateSelectedIndices(values);\n  }\n\n  valuesAreValid(values: (PDFString | PDFHexString)[]): boolean {\n    const options = this.getOptions();\n    for (let idx = 0, len = values.length; idx < len; idx++) {\n      const val = values[idx].decodeText();\n      if (!options.find((o) => val === (o.display || o.value).decodeText())) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  updateSelectedIndices(values: (PDFString | PDFHexString)[]) {\n    if (values.length > 1) {\n      const indices = new Array<number>(values.length);\n      const options = this.getOptions();\n      for (let idx = 0, len = values.length; idx < len; idx++) {\n        const val = values[idx].decodeText();\n        indices[idx] = options.findIndex(\n          (o) => val === (o.display || o.value).decodeText(),\n        );\n      }\n      this.dict.set(PDFName.of('I'), this.dict.context.obj(indices.sort()));\n    } else {\n      this.dict.delete(PDFName.of('I'));\n    }\n  }\n\n  getValues(): (PDFString | PDFHexString)[] {\n    const v = this.V();\n\n    if (v instanceof PDFString || v instanceof PDFHexString) return [v];\n\n    if (v instanceof PDFArray) {\n      const values: (PDFString | PDFHexString)[] = [];\n\n      for (let idx = 0, len = v.size(); idx < len; idx++) {\n        const value = v.lookup(idx);\n        if (value instanceof PDFString || value instanceof PDFHexString) {\n          values.push(value);\n        }\n      }\n\n      return values;\n    }\n\n    return [];\n  }\n\n  Opt(): PDFArray | PDFString | PDFHexString | undefined {\n    return this.dict.lookupMaybe(\n      PDFName.of('Opt'),\n      PDFString,\n      PDFHexString,\n      PDFArray,\n    );\n  }\n\n  setOptions(\n    options: {\n      value: PDFString | PDFHexString;\n      display?: PDFString | PDFHexString;\n    }[],\n  ) {\n    const newOpt = new Array<PDFArray>(options.length);\n    for (let idx = 0, len = options.length; idx < len; idx++) {\n      const { value, display } = options[idx];\n      newOpt[idx] = this.dict.context.obj([value, display || value]);\n    }\n    this.dict.set(PDFName.of('Opt'), this.dict.context.obj(newOpt));\n  }\n\n  getOptions(): {\n    value: PDFString | PDFHexString;\n    display: PDFString | PDFHexString;\n  }[] {\n    const Opt = this.Opt();\n\n    // Not supposed to happen - Opt _should_ always be `PDFArray | undefined`\n    if (Opt instanceof PDFString || Opt instanceof PDFHexString) {\n      return [{ value: Opt, display: Opt }];\n    }\n\n    if (Opt instanceof PDFArray) {\n      const res: {\n        value: PDFString | PDFHexString;\n        display: PDFString | PDFHexString;\n      }[] = [];\n\n      for (let idx = 0, len = Opt.size(); idx < len; idx++) {\n        const item = Opt.lookup(idx);\n\n        // If `item` is a string, use that as both the export and text value\n        if (item instanceof PDFString || item instanceof PDFHexString) {\n          res.push({ value: item, display: item });\n        }\n\n        // If `item` is an array of one, treat it the same as just a string,\n        // if it's an array of two then `item[0]` is the export value and\n        // `item[1]` is the text value\n        if (item instanceof PDFArray) {\n          if (item.size() > 0) {\n            const first = item.lookup(0, PDFString, PDFHexString);\n            const second = item.lookupMaybe(1, PDFString, PDFHexString);\n            res.push({ value: first, display: second || first });\n          }\n        }\n      }\n\n      return res;\n    }\n\n    return [];\n  }\n}\n\nexport default PDFAcroChoice;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}